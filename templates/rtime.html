<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
<link rel="icon" href="https://static.jianshukeji.com/highcharts/images/favicon.ico">
 <script src="http://libs.baidu.com/jquery/2.0.0/jquery.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">	<script src="https://code.highcharts.com.cn/highcharts/highcharts.js"></script>
	<script src="https://code.highcharts.com.cn/highcharts/modules/exporting.js"></script>
	<script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
</head>
<body>
<!--
*************************************************************************
   Generated by JShare at 2019-07-27 15:58:32
   From: https://jshare.com.cn/demos/hhhhDv
*************************************************************************
 -->
	<div id="container" style="min-width:400px;height:400px">
    </div>
    <div>
        <div>交易额:</div>
        <div id="jiaoyie">0</div><span>元</span>
        <div>订单数:</div>
        <div id="dingdanshu">0</div>
        <div>下单人数:</div>
        <div id="xiadanrensh">0</div>
    </div>
	<script>
	Highcharts.setOptions({
	global: {
		useUTC: false
	}
});
function activeLastPointToolip(chart) {
	var points = chart.series[0].points;
	chart.tooltip.refresh(points[points.length -1]);
}
debugger

var y_goloe = 0;
var pastnum = 0;
var gordernum = 0;
var gpersonum = 0;

 $.ajax({
                        type: 'post',
                        url: "http://127.0.0.1:8000/syn/getdata?",
                        data:{

                        },
                        dataType:'json',
                        success:function (ret) {
                            pastnum=ret.orderpay;
                            y_goloe=pastnum;
                        },
                        error:function (ret) {
                            console.log("error!")
                        }
                    });

setInterval(function () {
				    $.ajax({
                        type: 'post',
                        url: "http://127.0.0.1:8000/syn/getdata?",
                        data:{

                        },
                        dataType:'json',
                        success:function (ret) {
                            pastnum=ret.orderpay;
                            gordernum=ret.ordernum;
                            gpersonum=ret.personnum;
                            document.getElementById("jiaoyie").innerHTML = y_goloe.toFixed(2);
                            document.getElementById("dingdanshu").innerHTML=gordernum;
                            document.getElementById("xiadanrensh").innerHTML=gpersonum;
                        },
                        error:function (ret) {
                            console.log("error!")
                        }
                    });


				}, 3000);

var chart = Highcharts.chart('container', {
	chart: {
		type: 'spline',
		marginRight: 10,
		events: {
			load: function () {
				var series = this.series[0],
					chart = this;
				activeLastPointToolip(chart);
				setInterval(function () {
					var x = (new Date()).getTime();// 当前时间
						//y = parseInt(Math.random()*1000);       // 随机值
                    if(y_goloe<pastnum)
                    {
                        if((y_goloe+Math.random()*100)<=pastnum) {
                            y_goloe = y_goloe + Math.random() * 100;
                        }
                        else
                        {
                            y_goloe=pastnum;
                        }
                    }
                    else
                    {
                        y_goloe=pastnum;
                    }

                    series.addPoint([x, y_goloe], true, true);
                    activeLastPointToolip(chart);



				}, 1000);
			}
		}
	},
	title: {
		text: '销售实时数据'
	},
	xAxis: {
		type: 'datetime',
		tickPixelInterval: 150
	},
	yAxis: {
		title: {
			text: null
		}
	},
	tooltip: {
		formatter: function () {
			return '<b>' + this.series.name + '</b><br/>' +
				Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
				Highcharts.numberFormat(this.y, 2);
		}
	},
	legend: {
		enabled: false
	},
	series: [{
		name: '交易额',
		data: (function () {
			// 生成随机值
			var data = [],
				time = (new Date()).getTime(),
				i;
			for (i = -19; i <= 0; i += 1) {
				data.push({
					x: time + i * 1000,
					y: y_goloe//parseInt(Math.random()*1000)
				});
			}
			return data;
		}())
	}]
});</script>
</body>
</html>